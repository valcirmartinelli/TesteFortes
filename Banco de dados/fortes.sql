/******************************************************************************/
/*            Generated by IBExpert 2021.9.4.1 20/10/2021 10:30:45            */
/******************************************************************************/

SET SQL DIALECT 3;

SET NAMES NONE;

CREATE DATABASE 'C:\FORTES.fdb'
USER 'SYSDBA' PASSWORD 'masterkey'
PAGE_SIZE 16384
DEFAULT CHARACTER SET NONE COLLATION NONE;



/******************************************************************************/
/*                                 Generators                                 */
/******************************************************************************/

CREATE GENERATOR GEN_ABASTECIMENTO_ID;
SET GENERATOR GEN_ABASTECIMENTO_ID TO 6;

CREATE GENERATOR GEN_BOMBA_ID;
SET GENERATOR GEN_BOMBA_ID TO 3;

CREATE GENERATOR GEN_COMBUSTIVEL_ID;
SET GENERATOR GEN_COMBUSTIVEL_ID TO 6;

CREATE GENERATOR GEN_NEW_TABLE_ID;
SET GENERATOR GEN_NEW_TABLE_ID TO 0;

CREATE GENERATOR GEN_TANQUE_ID;
SET GENERATOR GEN_TANQUE_ID TO 3;



/******************************************************************************/
/*                             Stored procedures                              */
/******************************************************************************/



SET TERM ^ ;

CREATE PROCEDURE SP_GEN_COMBUSTIVEL_ID
RETURNS (
    ID INTEGER)
AS
BEGIN
  SUSPEND;
END^





CREATE PROCEDURE SP_GEN_NEW_TABLE_ID
RETURNS (
    ID INTEGER)
AS
BEGIN
  SUSPEND;
END^





CREATE PROCEDURE SP_GEN_TANQUE_ID
RETURNS (
    ID INTEGER)
AS
BEGIN
  SUSPEND;
END^






SET TERM ; ^



/******************************************************************************/
/*                                   Tables                                   */
/******************************************************************************/



CREATE TABLE ABASTECIMENTO (
    ID             INTEGER NOT NULL,
    ID_BOMBA       INTEGER NOT NULL,
    QTDE_LITRO     DOUBLE PRECISION NOT NULL,
    VALOR_UNIT     DOUBLE PRECISION NOT NULL,
    VALOR_IMPOSTO  DOUBLE PRECISION NOT NULL,
    VALOR_TOTAL    DOUBLE PRECISION NOT NULL,
    DATA           TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE TABLE BOMBA (
    ID         INTEGER NOT NULL,
    ID_TANQUE  INTEGER NOT NULL,
    DESCRICAO  VARCHAR(60) NOT NULL
);

CREATE TABLE COMBUSTIVEL (
    ID         INTEGER NOT NULL,
    SIGLA      VARCHAR(5) NOT NULL,
    DESCRICAO  VARCHAR(60) NOT NULL,
    VALOR      DOUBLE PRECISION NOT NULL
);

CREATE TABLE TANQUE (
    ID              INTEGER NOT NULL,
    ID_COMBUSTIVEL  INTEGER NOT NULL,
    DESCRICAO       VARCHAR(60) NOT NULL
);

INSERT INTO COMBUSTIVEL (ID, SIGLA, DESCRICAO, VALOR) VALUES (1, 'gas', 'gasolina', 5.98);
INSERT INTO COMBUSTIVEL (ID, SIGLA, DESCRICAO, VALOR) VALUES (2, 'die', 'diesel', 4.57);
INSERT INTO COMBUSTIVEL (ID, SIGLA, DESCRICAO, VALOR) VALUES (5, 'alc', 'alcool', 4.99);
INSERT INTO COMBUSTIVEL (ID, SIGLA, DESCRICAO, VALOR) VALUES (6, 'dieas', 'diesel aditivado', 4.55);


COMMIT WORK;

INSERT INTO TANQUE (ID, ID_COMBUSTIVEL, DESCRICAO) VALUES (1, 5, 'tanque 2');
INSERT INTO TANQUE (ID, ID_COMBUSTIVEL, DESCRICAO) VALUES (3, 2, 'tanque 1');


COMMIT WORK;

INSERT INTO BOMBA (ID, ID_TANQUE, DESCRICAO) VALUES (1, 3, 'bomba de gasolina1');
INSERT INTO BOMBA (ID, ID_TANQUE, DESCRICAO) VALUES (2, 1, 'bomba diesel');


COMMIT WORK;

INSERT INTO ABASTECIMENTO (ID, ID_BOMBA, QTDE_LITRO, VALOR_UNIT, VALOR_IMPOSTO, VALOR_TOTAL, DATA) VALUES (1, 1, 10, 4.57, 5.941, 45.7, '2021-10-19 02:18:09');
INSERT INTO ABASTECIMENTO (ID, ID_BOMBA, QTDE_LITRO, VALOR_UNIT, VALOR_IMPOSTO, VALOR_TOTAL, DATA) VALUES (2, 2, 5, 4.99, 3.2435, 24.95, '2021-10-19 02:18:23');
INSERT INTO ABASTECIMENTO (ID, ID_BOMBA, QTDE_LITRO, VALOR_UNIT, VALOR_IMPOSTO, VALOR_TOTAL, DATA) VALUES (3, 1, 5, 4.57, 2.9705, 22.85, '2021-10-20 07:52:10');
INSERT INTO ABASTECIMENTO (ID, ID_BOMBA, QTDE_LITRO, VALOR_UNIT, VALOR_IMPOSTO, VALOR_TOTAL, DATA) VALUES (4, 2, 6, 4.99, 3.8922, 29.94, '2021-10-20 07:52:22');
INSERT INTO ABASTECIMENTO (ID, ID_BOMBA, QTDE_LITRO, VALOR_UNIT, VALOR_IMPOSTO, VALOR_TOTAL, DATA) VALUES (5, 2, 15, 4.99, 9.7305, 74.85, '2021-10-20 07:52:34');
INSERT INTO ABASTECIMENTO (ID, ID_BOMBA, QTDE_LITRO, VALOR_UNIT, VALOR_IMPOSTO, VALOR_TOTAL, DATA) VALUES (6, 1, 20, 4.57, 11.882, 91.4, '2021-10-20 07:52:38');


COMMIT WORK;



/******************************************************************************/
/*                                Primary keys                                */
/******************************************************************************/

ALTER TABLE ABASTECIMENTO ADD CONSTRAINT PK_ABASTECIMENTO PRIMARY KEY (ID);
ALTER TABLE BOMBA ADD CONSTRAINT PK_BOMBA PRIMARY KEY (ID);
ALTER TABLE COMBUSTIVEL ADD PRIMARY KEY (ID);
ALTER TABLE TANQUE ADD PRIMARY KEY (ID);


/******************************************************************************/
/*                                Foreign keys                                */
/******************************************************************************/

ALTER TABLE ABASTECIMENTO ADD CONSTRAINT FK_ABASTECIMENTO_1 FOREIGN KEY (ID_BOMBA) REFERENCES BOMBA (ID);
ALTER TABLE BOMBA ADD CONSTRAINT FK_BOMBA_1 FOREIGN KEY (ID_TANQUE) REFERENCES TANQUE (ID);
ALTER TABLE TANQUE ADD CONSTRAINT FK_TANQUE_1 FOREIGN KEY (ID_COMBUSTIVEL) REFERENCES COMBUSTIVEL (ID);


/******************************************************************************/
/*                                  Triggers                                  */
/******************************************************************************/



SET TERM ^ ;



/******************************************************************************/
/*                            Triggers for tables                             */
/******************************************************************************/



/* Trigger: ABASTECIMENTO_BI */
CREATE TRIGGER ABASTECIMENTO_BI FOR ABASTECIMENTO
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_abastecimento_id,1);
end
^

/* Trigger: BOMBA_BI */
CREATE TRIGGER BOMBA_BI FOR BOMBA
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_bomba_id,1);
end
^

/* Trigger: COMBUSTIVEL_BI */
CREATE TRIGGER COMBUSTIVEL_BI FOR COMBUSTIVEL
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_combustivel_id,1);
end
^

/* Trigger: TANQUE_BI */
CREATE TRIGGER TANQUE_BI FOR TANQUE
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_tanque_id,1);
end
^
SET TERM ; ^



/******************************************************************************/
/*                             Stored procedures                              */
/******************************************************************************/



SET TERM ^ ;

ALTER PROCEDURE SP_GEN_COMBUSTIVEL_ID
RETURNS (
    ID INTEGER)
AS
begin
  id = gen_id(gen_combustivel_id, 1);
  suspend;
end^


ALTER PROCEDURE SP_GEN_NEW_TABLE_ID
RETURNS (
    ID INTEGER)
AS
begin
  id = gen_id(gen_new_table_id, 1);
  suspend;
end^


ALTER PROCEDURE SP_GEN_TANQUE_ID
RETURNS (
    ID INTEGER)
AS
begin
  id = gen_id(gen_tanque_id, 1);
  suspend;
end^



SET TERM ; ^

